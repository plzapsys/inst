[client]
default-character-set = utf8mb4

[mysqld]
# --- General ---

collation-server 				= utf8mb4_unicode_ci
init-connect 					= 'SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci'
character-set-server            = utf8mb4

performance_schema              = 1
max_allowed_packet              = 256M
open_files_limit                = 65535
max_connections                 = 400

# --- InnoDB Memory & CPU ---
innodb_buffer_pool_size         = 22G       # Оставяме достатъчно за ОС и системни процеси
innodb_log_file_size            = 2G        # Помага при интензивни записи в споделен сториж
innodb_log_buffer_size          = 64M

# --- VMware & SSD I/O ---
innodb_flush_log_at_trx_commit  = 2         # ПРЕПОРЪКА: Намалява латентността при споделено SSD
innodb_doublewrite              = 1         # Държим го включено за сигурност върху VMFS
innodb_io_capacity              = 1500
innodb_io_capacity_max          = 3000
innodb_flush_neighbors          = 0         # SSD не се нуждае от това
innodb_read_io_threads          = 16
innodb_write_io_threads         = 16

# --- Buffer Pool Warming ---
innodb_buffer_pool_dump_at_shutdown = 1
innodb_buffer_pool_load_at_startup  = 1
innodb_buffer_pool_dump_pct         = 50

# --- Thread Limits (Anti-Crash) ---
tmp_table_size                  = 64M
max_heap_table_size             = 64M
join_buffer_size                = 2M
sort_buffer_size                = 2M
read_buffer_size                = 1M
read_rnd_buffer_size            = 1M

# --- Logging ---
slow_query_log                  = 1
slow_query_log_file             = /var/log/mariadb/mariadb-slow.log
long_query_time                 = 1

# --- Log Management ---
log_queries_not_using_indexes   = 0      # Дръжте го OFF, освен при дебъгване
log_slow_rate_limit             = 1      # Логва всяка заявка (в MariaDB може да се ограничи, ако логът стане огромен)
log_slow_verbosity              = query_plan,explain # Дава детайлна информация защо заявката е бавна
