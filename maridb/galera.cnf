
# /etc/mysql/mariadb.conf.d/60-galera.cnf

[galera]
# --- Mandatory settings for Galera ---
binlog_format=ROW
default-storage-engine=innodb
innodb_autoinc_lock_mode=2
bind-address=0.0.0.0

# --- Galera Provider Configuration ---
wsrep_on=ON
wsrep_provider=/usr/lib64/galera-4/libgalera_smm.so

# 2. --- Galera Cluster Configuration ---
# This name must be identical on all nodes
wsrep_cluster_name="VoIPmonitor_Cluster"
# List all nodes in the cluster. When starting, a node will try to connect to these to sync.
wsrep_cluster_address="gcomm://192.168.0.1,192.168.0.2,192.168.0.3"

# --- Galera Synchronization Method ---
# 'rsync' is a common and reliable choice for state transfers.
wsrep_sst_method=rsync

# --- INDIVIDUAL NODE Configuration ---
# THESE TWO LINES MUST BE UNIQUE ON EACH NODE!
wsrep_node_address="192.168.0.1"  # Use this node's own IP address
wsrep_node_name="Node-01"         # Give each node a unique name

# --- Galera Performance Tuning ---
# gcache stores the replication writeset. 10G is a good starting point.
wsrep_provider_options="gcache.size=10G;gcache.recover=yes;gcs.fc_limit=500000;"

# -------------- from Site MariaDB
# https://mariadb.com/docs/galera-cluster/galera-cluster-quickstart-guides/mariadb-galera-cluster-guide
[mysqld]
# Basic MariaDB settings
binlog_format=ROW
default_storage_engine=InnoDB
innodb_autoinc_lock_mode=2
bind-address=0.0.0.0 # Binds to all network interfaces. Adjust if you have a specific private IP for cluster traffic.

# Galera Provider Configuration
wsrep_on=ON
wsrep_provider=/usr/lib/galera/libgalera_smm.so # Adjust path if different (e.g., /usr/lib64/galera-4/libgalera_smm.so)

# Galera Cluster Configuration
wsrep_cluster_name="my_galera_cluster" # A unique name for your cluster

# IP addresses of ALL nodes in the cluster, comma-separated.
# Use private IPs if available for cluster communication.
wsrep_cluster_address="gcomm://node1_ip_address,node2_ip_address,node3_ip_address"

# This node's specific configuration
wsrep_node_name="node1" # Must be unique for each node (e.g., node1, node2, node3)
wsrep_node_address="node1_ip_address" # This node's own IP address


#---------------------------------------------------------------------

# 3. On your first node (e.g., Node-01)
galera_new_cluster

# -4 On Node-02 and Node-03
systemctl start mariadb

# -------------------------------------
