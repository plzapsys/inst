
server {
    #### set port ###############
    listen       8001;
    ##### set servername ########
    server_name localhost_8001;
    ### set root path sources ########
    root         /mnt/sources/site-01/www;
    #### set upload file ########
    client_max_body_size 21M; 

    # ----------------------------------------------------------------
    # Add index.php to the list if you are using PHP
    index index.php index.html;

    # include compression 
    include /etc/nginx/conf.d/include/compression.conf;
    # include security headers config
    # include /etc/nginx/conf.d/include/security_headers_http.conf;    

    location / {
        # First attempt to serve request as file, then
        # as directory, then fall back to index.php
        try_files $uri $uri/ /index.php$is_args$args;
        # ----- rewrite rule --------------------
        # if (!-e $request_filename){
        #     rewrite ^/lo/(\d+)*$ /main/base/login.php;
        # }
    # ---------------------------------------
    }

    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        # fastcgi_intercept_errors on;
        fastcgi_pass   php-fpm;
        fastcgi_index  index.php;
        include        fastcgi_params;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        #--------------------------------------------------
        fastcgi_hide_header X-Powered-By;
        fastcgi_param REMOTE_ADDR $http_x_forwarded_for;

        ##### set upload file size ######################
        fastcgi_param PHP_VALUE "expose_php= Off \n date.timezone='Europe/Sofia' \n upload_max_size=21M \n post_max_size=21M \n upload_max_filesize = 21M \n memory_limit=128M";

        ###### set patch log file ######################
        fastcgi_param PHP_ADMIN_VALUE   "error_log=/mnt/sources/site-01/log/error.log";
        ###
        # fastcgi_param PHP_ADMIN_VALUE   "xdebug.start_with_request = yes \n xdebug.log_level=10 \n xdebug.log=/mnt/sources/site-01/log/xdebug.log ";
        fastcgi_param PHP_ADMIN_VALUE   "xdebug.start_with_request = yes \n xdebug.log_level=10";

    }

}

server {
    #### set port ###############
    listen 44301 ssl;
    ##### set servername ########
    server_name localhost_44301;
    ### set root path sources ########
    root    /mnt/sources/site-01/www;
    #### set upload file ########
    client_max_body_size 21M; 

    http2 on;

    # Add index.php to the list if you are using PHP
    index index.php index.html;

    # include compression 
    include /etc/nginx/conf.d/include/compression.conf;
    # include security headers config
    include /etc/nginx/conf.d/include/security_headers_https.conf;

    # include ssl config
    include /etc/nginx/conf.d/include/tls.conf;

    location / {
        # First attempt to serve request as file, then
        # as directory, then fall back to index.php
        try_files $uri $uri/ /index.php$is_args$args;
        # ----- rewrite rule --------------------
            # if (!-e $request_filename){
            #     rewrite ^/lo/(\d+)*$ /main/base/login.php;
            # }
        # ---------------------------------------
    }

    # include assets config
    include /etc/nginx/conf.d/include/assets.conf; 

    # Pass the PHP scripts to PHP-FPM listening on php-fpm.sock
    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass   php-fpm;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_index index.php;
        include fastcgi_params;
        #--------------------------------------------------
        fastcgi_hide_header X-Powered-By;
        fastcgi_param REMOTE_ADDR $http_x_forwarded_for; 

        ##### set upload file size ######################
        fastcgi_param PHP_VALUE "expose_php= Off \n date.timezone='Europe/Sofia' \n upload_max_size=21M \n post_max_size=21M \n upload_max_filesize = 21M \n memory_limit=128M";

        ###### set patch log file ######################
        fastcgi_param PHP_ADMIN_VALUE   "error_log=/mnt/sources/site-01/log/error.log";
        # fastcgi_param PHP_ADMIN_VALUE   "xdebug.log_level=0 \n xdebug.log=/mnt/sources/site-01/log/xdebug.log \n";
    }
}
